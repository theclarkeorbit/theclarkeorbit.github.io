
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet/less" type="text/css" href="./theme/stylesheet/style.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>

  <link rel="stylesheet" type="text/css" href="./theme/pygments/colorful.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/font-awesome.min.css">




    <link rel="shortcut icon" href="https://www.theclarkeorbit.com/images/favicon.png" type="image/x-icon">
    <link rel="icon" href="https://www.theclarkeorbit.com/images/favicon.png" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="pras" />
<meta name="description" content="This notebook contains one simple worked out example with the new - still in its infancy - PPL in R with a Tensorflow backend : Greta For a more mature PPL in Python also with a tensorflow backend, see Edward. Basic linear regression. We will generate artificial data with known parameters, so that we can check if Greta gets it right later. Generating fake data to fit a model to length_of_data <- 100 sd_eps <- pi^exp(1) intercept <- -5.0 slope <- pi x <- seq(-10*pi, 10*pi, length.out = length_of_data) y <- intercept + slope*x + rnorm(n = length_of_data, mean = 0, sd = sd_eps) data <- data_frame …" />
<meta name="keywords" content="">
<meta property="og:site_name" content="p. bhogale"/>
<meta property="og:title" content="“greta playground”"/>
<meta property="og:description" content="This notebook contains one simple worked out example with the new - still in its infancy - PPL in R with a Tensorflow backend : Greta For a more mature PPL in Python also with a tensorflow backend, see Edward. Basic linear regression. We will generate artificial data with known parameters, so that we can check if Greta gets it right later. Generating fake data to fit a model to length_of_data <- 100 sd_eps <- pi^exp(1) intercept <- -5.0 slope <- pi x <- seq(-10*pi, 10*pi, length.out = length_of_data) y <- intercept + slope*x + rnorm(n = length_of_data, mean = 0, sd = sd_eps) data <- data_frame …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./greta-playground.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-03-14 14:50:49.578666+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/pras.html">
<meta property="article:section" content="blogs"/>
<meta property="og:image" content="https://en.gravatar.com/userimage/9352950/78ed70e67418f76f23b494458d53ac7d.jpg?size=400">

  <title>p. bhogale &ndash; “greta playground”</title>

</head>
<body>
  <aside>
    <div>
      <a href=".">
        <img src="https://en.gravatar.com/userimage/9352950/78ed70e67418f76f23b494458d53ac7d.jpg?size=400" alt="prasanna bhogale" title="prasanna bhogale">
      </a>
      <h1><a href=".">prasanna bhogale</a></h1>

<p>Data Sci, Quant Fin, Quant Bio.</p>
      <nav>
        <ul class="list">
          <li><a href="./pages/about.html#about">about</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/pbhogale" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/thegymnosophist" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/pbhogale" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href=".">    Home
</a>



    </nav>

<article class="single">
  <header>
    <h1 id="greta-playground"><span class="dquo">&#8220;</span>greta&nbsp;playground&#8221;</h1>
    <p>
          Posted on Wed 14 March 2018 in <a href="./category/blogs.html">blogs</a>


    </p>
  </header>


  <div>
    <p>This notebook contains one simple worked out example with the new - still in its infancy - <span class="caps">PPL</span> in R with a Tensorflow backend : <a href="https://greta-dev.github.io/greta/index.html">Greta</a></p>
<p>For a more mature <span class="caps">PPL</span> in Python also with a tensorflow backend, see <a href="http://edwardlib.org/">Edward</a>.</p>
<h2>Basic linear&nbsp;regression.</h2>
<p>We will generate artificial data with known parameters, so that we can check if Greta gets it right&nbsp;later. </p>
<h3>Generating fake data to fit a model&nbsp;to</h3>
<div class="highlight"><pre><span></span>length_of_data <span class="o">&lt;-</span> <span class="m">100</span>
sd_eps <span class="o">&lt;-</span> <span class="kc">pi</span><span class="o">^</span><span class="kp">exp</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
intercept <span class="o">&lt;-</span> <span class="m">-5.0</span>
slope <span class="o">&lt;-</span> <span class="kc">pi</span>
x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-10</span><span class="o">*</span><span class="kc">pi</span><span class="p">,</span> <span class="m">10</span><span class="o">*</span><span class="kc">pi</span><span class="p">,</span> length.out <span class="o">=</span> length_of_data<span class="p">)</span>
y <span class="o">&lt;-</span> intercept <span class="o">+</span> slope<span class="o">*</span>x <span class="o">+</span> rnorm<span class="p">(</span>n <span class="o">=</span> length_of_data<span class="p">,</span> mean <span class="o">=</span> <span class="m">0</span><span class="p">,</span> sd <span class="o">=</span> sd_eps<span class="p">)</span>
data <span class="o">&lt;-</span> <span class="kt">data_frame</span><span class="p">(</span>y <span class="o">=</span> y<span class="p">,</span> x <span class="o">=</span> x<span class="p">)</span>
ggplot<span class="p">(</span>data<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> x<span class="p">,</span> y <span class="o">=</span> y<span class="p">))</span> <span class="o">+</span>
  geom_point<span class="p">()</span> <span class="o">+</span>
  geom_smooth<span class="p">(</span>method <span class="o">=</span> <span class="s">&#39;lm&#39;</span><span class="p">)</span> <span class="o">+</span>
  ggtitle<span class="p">(</span><span class="s">&quot;Fake experimental data&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="center" src="/figures/greta_playground/unnamed-chunk-2-1.png"></p>
<p>Given this data, we want to write Greta code to infer the model parameters. Since we really don&#8217;t know anything about the prior distributions of our parameters, we look at the experimental data and take rough, uniform&nbsp;priors. </p>
<h3>Defining clueless priors for model&nbsp;parameters</h3>
<div class="highlight"><pre><span></span>intercept_p <span class="o">&lt;-</span> uniform<span class="p">(</span><span class="m">-10</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
sd_eps_p <span class="o">&lt;-</span> uniform<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">50</span><span class="p">)</span>
slope_p <span class="o">&lt;-</span> uniform<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</pre></div>


<p>Now, we define and plot the&nbsp;model.</p>
<h3>Defining the&nbsp;model</h3>
<div class="highlight"><pre><span></span>mean_y <span class="o">&lt;-</span> intercept_p<span class="o">+</span>slope_p<span class="o">*</span>x
distribution<span class="p">(</span>y<span class="p">)</span> <span class="o">&lt;-</span> normal<span class="p">(</span>mean_y<span class="p">,</span> sd_eps_p<span class="p">)</span>

our_model <span class="o">&lt;-</span> model<span class="p">(</span>intercept_p<span class="p">,</span> slope_p<span class="p">,</span> sd_eps_p<span class="p">)</span>
plot<span class="p">(</span>our_model<span class="p">)</span>
</pre></div>


<h3>Fitting model to&nbsp;data</h3>
<p>Now, we sample from our&nbsp;model</p>
<div class="highlight"><pre><span></span>num_samples <span class="o">&lt;-</span> <span class="m">1000</span>
param_draws <span class="o">&lt;-</span> mcmc<span class="p">(</span>our_model<span class="p">,</span> n_samples <span class="o">=</span> num_samples<span class="p">,</span> warmup <span class="o">=</span> num_samples <span class="o">/</span> <span class="m">10</span><span class="p">)</span>
</pre></div>


<p>and plot the samples, and the parameter&nbsp;fits.</p>
<div class="highlight"><pre><span></span>mcmc_dens<span class="p">(</span>param_draws<span class="p">)</span>
</pre></div>


<p><img alt="center" src="/figures/greta_playground/unnamed-chunk-6-1.png"></p>
<div class="highlight"><pre><span></span>mcmc_intervals<span class="p">(</span>param_draws<span class="p">)</span>
</pre></div>


<p><img alt="center" src="/figures/greta_playground/unnamed-chunk-6-2.png"></p>
<p>By inspection, it looks like the <a href="https://arxiv.org/abs/1701.02434"><span class="caps">HMC</span></a> has reached some reasonable values for our model&nbsp;parameters. </p>
<p>Explicitly, the mean estimates can be computed from the <code>param_draws</code> data structure, or via the <code>greta::opt</code> function.   </p>
<div class="highlight"><pre><span></span>param_draws_df <span class="o">&lt;-</span> as_data_frame<span class="p">(</span>param_draws<span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
param_estimates <span class="o">&lt;-</span> param_draws_df <span class="o">%&gt;%</span> 
  summarise_all<span class="p">(</span><span class="kp">mean</span><span class="p">)</span>
param_estimates <span class="o">%&gt;%</span> <span class="kp">print</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>## # A tibble: 1 x 3
##   intercept_p slope_p sd_eps_p
##         &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1       -3.73    3.07     23.7
</pre></div>


<div class="highlight"><pre><span></span>opt_params <span class="o">&lt;-</span> opt<span class="p">(</span>our_model<span class="p">)</span>
opt_params<span class="o">$</span>par <span class="o">%&gt;%</span> <span class="kp">print</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>## intercept_p     slope_p    sd_eps_p 
##   -4.871728    3.020079   24.257370
</pre></div>


<h3>Plotting against&nbsp;data</h3>
<p>the <code>calculate()</code> function is available on the latest release of <code>greta</code> on&nbsp;github.</p>
<div class="highlight"><pre><span></span>mean_y_plot <span class="o">&lt;-</span> intercept_p<span class="o">+</span>slope_p<span class="o">*</span>x
mean_y_plot_draws <span class="o">&lt;-</span> calculate<span class="p">(</span>mean_y_plot<span class="p">,</span> param_draws<span class="p">)</span>
mean_y_est <span class="o">&lt;-</span> <span class="kp">colMeans</span><span class="p">(</span>mean_y_plot_draws<span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
data_pred <span class="o">&lt;-</span> data <span class="o">%&gt;%</span> mutate<span class="p">(</span>y_fit <span class="o">=</span> mean_y_est<span class="p">)</span>
ggplot<span class="p">(</span>data_pred<span class="p">)</span> <span class="o">+</span>
    geom_point<span class="p">(</span>aes<span class="p">(</span>x<span class="p">,</span>y<span class="p">),</span> colour <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">)</span> <span class="o">+</span>
    geom_line<span class="p">(</span>aes<span class="p">(</span>x<span class="p">,</span>y_fit<span class="p">),</span> colour <span class="o">=</span> <span class="s">&#39;red&#39;</span><span class="p">)</span> <span class="o">+</span>
    ggtitle<span class="p">(</span><span class="s">&quot;Fitted model&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="center" src="/figures/greta_playground/unnamed-chunk-8-1.png"></p>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>




</article>

    <footer>
<p>&copy; pras </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " p. bhogale ",
  "url" : ".",
  "image": "https://en.gravatar.com/userimage/9352950/78ed70e67418f76f23b494458d53ac7d.jpg?size=400",
  "description": "pras's home on the interwebz"
}
</script>
</body>
</html>